# precompute_embeddings.py
import json
import os
from openai import OpenAI

client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

with open("chunks.json", "r") as f:
    chunks = [json.loads(line) for line in f]

for chunk in chunks:
    emb = client.embeddings.create(
        model="text-embedding-3-small",
        input=chunk["content"]
    )
    chunk["embedding"] = emb.data[0].embedding

with open("chunks.json", "w") as f:
    for chunk in chunks:
        f.write(json.dumps(chunk) + "\n")

print("Embeddings saved.")
